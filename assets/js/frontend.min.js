!function(){"use strict";var t={config:{ajaxUrl:"",nonce:"",enableAjax:!0,updateDelay:1e3,selectors:{counter:".woo-cart-counter",count:".woo-cart-counter-count",total:".woo-cart-counter-total",widget:".woo-cart-counter-widget-content"}},state:{isUpdating:!1,updateTimeout:null,lastCount:null},init:function(){"undefined"!=typeof window.wooCartCounter&&(this.config=Object.assign(this.config,window.wooCartCounter)),this.bindEvents(),this.initializeState(),this.setupMutationObserver()},bindEvents:function(){var t=this;window.jQuery&&(jQuery(document.body).on("added_to_cart removed_from_cart updated_cart_totals",function(){t.scheduleUpdate()}),jQuery(document).on("cart_page_refreshed cart_totals_refreshed",function(){t.scheduleUpdate()}),jQuery(document.body).on("wc_fragments_refreshed",function(){t.updateFromFragments()})),document.addEventListener("woo_cart_counter_update",function(){t.scheduleUpdate()}),window.addEventListener("storage",function(e){"woo_cart_counter_data"===e.key&&t.updateFromStorage(e.newValue)}),document.addEventListener("visibilitychange",function(){document.hidden||t.scheduleUpdate()})},initializeState:function(){var t=document.querySelectorAll(this.config.selectors.count);t.length>0&&(this.state.lastCount=parseInt(t[0].getAttribute("data-count")||t[0].textContent,10));var e=this.getStoredData();e&&this.updateCounters(e)},setupMutationObserver:function(){var t=this;if(window.MutationObserver){new MutationObserver(function(e){e.forEach(function(e){e.addedNodes.length&&e.addedNodes.forEach(function(e){1===e.nodeType&&e.matches&&e.matches(t.config.selectors.counter)&&t.updateSingleCounter(e)})})}).observe(document.body,{childList:!0,subtree:!0})}},scheduleUpdate:function(){var t=this;this.config.enableAjax&&(this.state.updateTimeout&&clearTimeout(this.state.updateTimeout),this.state.updateTimeout=setTimeout(function(){t.updateCart()},this.config.updateDelay))},updateCart:function(){var t=this;if(!this.state.isUpdating){this.state.isUpdating=!0;var e=new XMLHttpRequest;e.open("POST",this.config.ajaxUrl||this.config.ajax_url,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.onload=function(){if(t.state.isUpdating=!1,e.status>=200&&e.status<300)try{var n=JSON.parse(e.responseText);n.success&&n.data&&t.handleUpdateResponse(n.data)}catch(t){console.error("WooCartCounter: Failed to parse response",t)}},e.onerror=function(){t.state.isUpdating=!1,console.error("WooCartCounter: AJAX request failed")};var n="action=woo_cart_counter_update&nonce="+encodeURIComponent(this.config.nonce);e.send(n)}},handleUpdateResponse:function(t){this.updateCounters(t),this.storeData(t),this.triggerEvent("updated",t),t.fragments&&this.updateFragments(t.fragments)},updateCounters:function(t){var e=this;if(void 0!==t.count){document.querySelectorAll(this.config.selectors.count).forEach(function(e){e.textContent=t.count,e.setAttribute("data-count",t.count)}),document.querySelectorAll(this.config.selectors.counter).forEach(function(e){0===t.count?e.classList.add("woo-cart-counter-empty"):e.classList.remove("woo-cart-counter-empty")}),null!==this.state.lastCount&&this.state.lastCount!==t.count&&this.animateCountChange(t.count>this.state.lastCount),this.state.lastCount=t.count}t.total&&document.querySelectorAll(this.config.selectors.total).forEach(function(e){e.innerHTML=t.total})},updateSingleCounter:function(t){var e=this.getStoredData();if(e){var n=t.querySelector(this.config.selectors.count);n&&(n.textContent=e.count,n.setAttribute("data-count",e.count));var o=t.querySelector(this.config.selectors.total);o&&e.total&&(o.innerHTML=e.total),0===e.count?t.classList.add("woo-cart-counter-empty"):t.classList.remove("woo-cart-counter-empty")}},updateFragments:function(t){Object.keys(t).forEach(function(e){document.querySelectorAll(e).forEach(function(n){var o=document.createElement("div");o.innerHTML=t[e];var a=o.firstChild;a&&n.parentNode.replaceChild(a,n)})})},updateFromFragments:function(){},animateCountChange:function(t){var e=t?"woo-cart-counter-increase":"woo-cart-counter-decrease";document.querySelectorAll(this.config.selectors.counter).forEach(function(t){t.classList.add(e),setTimeout(function(){t.classList.remove(e)},600)})},storeData:function(t){if(window.localStorage)try{var e={count:t.count,total:t.total,timestamp:Date.now()};localStorage.setItem("woo_cart_counter_data",JSON.stringify(e))}catch(t){}},getStoredData:function(){if(!window.localStorage)return null;try{var t=localStorage.getItem("woo_cart_counter_data");if(t){var e=JSON.parse(t);if(e.timestamp&&Date.now()-e.timestamp<3e5)return e}}catch(t){}return null},updateFromStorage:function(t){if(t)try{var e=JSON.parse(t);this.updateCounters(e)}catch(t){}},triggerEvent:function(t,e){var n;n="function"==typeof CustomEvent?new CustomEvent("woo_cart_counter_"+t,{detail:e,bubbles:!0,cancelable:!0}):(n=document.createEvent("CustomEvent")).initCustomEvent("woo_cart_counter_"+t,!0,!0,e),document.dispatchEvent(n)}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){t.init()}):t.init(),window.WooCartCounterInstance=t}();